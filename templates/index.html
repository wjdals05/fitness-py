`<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Smart Health AI</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body { font-family: 'Segoe UI', sans-serif; padding: 20px; background: #f8fafc; display: flex; justify-content: center; }
        .container { max-width: 600px; width: 100%; background: white; padding: 25px; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        h1 { text-align:center; color:#6366f1; margin-bottom: 20px; }
        
        /* ì…ë ¥ í¼ ìŠ¤íƒ€ì¼ */
        .input-group { margin-bottom: 15px; }
        input, select { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; margin-top: 5px; }
        button { width: 100%; padding: 15px; background: #6366f1; color: white; border: none; border-radius: 10px; margin-top: 10px; cursor: pointer; font-weight: bold; transition: 0.3s; }
        button:hover { background: #4f46e5; }
        
        /* ê²°ê³¼ì°½ ìŠ¤íƒ€ì¼ */
        .result-box { background: #e0e7ff; padding: 15px; border-radius: 10px; margin-top: 20px; display: none; border: 1px solid #c7d2fe; }
        img { width: 100%; margin-top: 15px; border-radius: 10px; border: 1px solid #eee; }
        
        /* ë£¨í‹´ ì¶”ì²œ ì„¹ì…˜ ìŠ¤íƒ€ì¼ */
        .routine-section { margin-top: 30px; border-top: 2px dashed #eee; padding-top: 20px; }
        .tag { display: inline-block; background: #eff6ff; color: #3b82f6; padding: 4px 8px; border-radius: 4px; font-size: 0.8rem; margin-bottom: 5px; }
    </style>
</head>
<body>
    <div class="container">
        <h1><i class="fas fa-dumbbell"></i> Smart AI Coach</h1>

        <div class="input-group">
            <span class="tag">Step 1</span> <strong>ìš´ë™ ê¸°ë¡ & AI ë¶„ì„</strong>
            <input type="text" id="exercise" placeholder="ìš´ë™ ì´ë¦„ (ì˜ˆ: ìŠ¤ì¿¼íŠ¸)">
            <input type="number" id="weight" placeholder="ë¬´ê²Œ (kg)">
            <input type="number" id="reps" placeholder="íšŸìˆ˜">
            <input type="text" id="feedback" placeholder="ì˜¤ëŠ˜ ëŠë‚Œ (AI ë¶„ì„ìš©)">
            <button onclick="sendLog()">ê¸°ë¡ ì €ì¥ ë° ë¶„ì„</button>
        </div>

        <div id="log_result" class="result-box">
            <h3 id="ai_msg" style="margin:0 0 10px 0;"></h3>
            <p id="rec_msg" style="margin:0; color:#4338ca; font-weight:600;"></p>
        </div>

        <div class="routine-section">
            <span class="tag">Step 2</span> <strong>ì˜¤ëŠ˜ì˜ ë£¨í‹´ ì¶”ì²œë°›ê¸°</strong>
            <div style="display:flex; gap:10px;">
                <select id="level">
                    <option value="beginner">ì´ˆë³´ì (í—¬ë¦°ì´)</option>
                    <option value="advanced">ìˆ™ë ¨ì (í—¬ì°½)</option>
                </select>
                <select id="goal">
                    <option value="muscle">ê·¼ìœ¡ ì¦ê°€</option>
                    <option value="diet">ë‹¤ì´ì–´íŠ¸</option>
                </select>
            </div>
            <button onclick="getRoutine()" style="background:#10b981;">ë£¨í‹´ ìƒì„±í•˜ê¸°</button>
            <div id="routine_result" class="result-box" style="background:#ecfdf5; border-color:#a7f3d0; color:#047857; font-weight:bold;"></div>
        </div>

        <img src="/api/graph/weekly" id="img1">
        <img src="/api/graph/area" id="img2">
    </div>

    <script>
        // ìš´ë™ ê¸°ë¡ ì „ì†¡
        async function sendLog() {
            const data = { 
                exercise: document.getElementById('exercise').value, 
                weight: document.getElementById('weight').value, 
                reps: document.getElementById('reps').value, 
                feedback: document.getElementById('feedback').value 
            };
            const res = await fetch('/api/log', { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify(data) });
            const result = await res.json();
            
            const box = document.getElementById('log_result');
            box.style.display = 'block';
            document.getElementById('ai_msg').innerText = `ğŸ¤– AI ë¶„ì„: ${result.ai_analysis.label} (${result.ai_analysis.score}ì )`;
            document.getElementById('rec_msg').innerText = `ğŸ’¡ ì¶”ì²œ: ë‹¤ìŒì—” ${result.recommended_weight}kg ë„ì „!`;
            
            refreshGraphs();
        }

        // ë£¨í‹´ ì¶”ì²œ ìš”ì²­ (5ë²ˆ íŒ€ì›ì´ ë§Œë“  ê¸°ëŠ¥)
        async function getRoutine() {
            const level = document.getElementById('level').value;
            const goal = document.getElementById('goal').value;
            
            const res = await fetch('/api/routine', { 
                method: 'POST', 
                headers: {'Content-Type': 'application/json'}, 
                body: JSON.stringify({ level, goal }) 
            });
            const result = await res.json();
            
            const box = document.getElementById('routine_result');
            box.style.display = 'block';
            box.innerText = result.routine;
        }

        function refreshGraphs() {
            const t = new Date().getTime();
            document.getElementById('img1').src = `/api/graph/weekly?t=${t}`; 
            document.getElementById('img2').src = `/api/graph/area?t=${t}`;
        }
    </script>
</body>
</html>